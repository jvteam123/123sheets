<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lite Project Time Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .bg-slate-900 {
            background-color: #0F172A;
        }
        .text-white {
            color: #FFFFFF;
        }
    </style>
</head>
<body class="bg-slate-900 text-white">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js';
        import {
            getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, deleteDoc,
            query, where, serverTimestamp, orderBy, writeBatch, getDocs
        } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js';

        window.firebaseConfig = {
            apiKey: "AIzaSyA8WIXfj00AxSkecGqrWpk61pIQrgSmmEo",
            authDomain: "react-time-tracker-cdbd2.firebaseapp.com",
            projectId: "react-time-tracker-cdbd2",
            storageBucket: "react-time-tracker-cdbd2.firebasestorage.app",
            messagingSenderId: "1043791910954",
            appId: "1:1043791910954:web:f56c707e26ab592c56cb53"
        };
        
        window.firebase = {
            initializeApp, getAuth, signInAnonymously, getFirestore,
            collection, addDoc, onSnapshot, updateDoc, doc, deleteDoc,
            query, where, serverTimestamp, orderBy, writeBatch, getDocs
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { initializeApp, getAuth, signInAnonymously, getFirestore,
            collection, addDoc, onSnapshot, updateDoc, doc, deleteDoc,
            query, where, serverTimestamp, orderBy, writeBatch, getDocs
        } = window.firebase;

        const PlayIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
        );

        const StopIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
          </svg>
        );

        const PlusIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        );

        const Trash2Icon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        );

        const EditIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
          </svg>
        );

        const SaveIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
        );

        const XIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        );

        const ResetIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M21 12a9 9 0 1 1-9-9c2.72 0 5.06 1.154 6.74 3.03l-1.42 1.42"></path>
            <path d="M21 12V3h-9"></path>
          </svg>
        );

        const formatDuration = (milliseconds) => {
          if (milliseconds === null || milliseconds === undefined) {
            return '0m';
          }
          const totalSeconds = Math.floor(milliseconds / 1000);
          const minutes = Math.floor(totalSeconds / 60);
          const seconds = totalSeconds % 60;
          return `${minutes}m ${seconds}s`;
        };

        const formatTotalMinutes = (milliseconds) => {
          if (milliseconds === null || milliseconds === undefined) {
            return '0 mins';
          }
          const totalMinutes = Math.round(milliseconds / (1000 * 60));
          return `${totalMinutes} mins`;
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const collectionPath = `/artifacts/${appId}/public/data/projects`;

        const FIX_CATEGORIES = {
            ORDER: ["Fix1", "Fix2", "Fix3", "Fix4", "Fix5", "Fix6"],
        };
        
        function App() {
          const [db, setDb] = useState(null);
          const [auth, setAuth] = useState(null);
          const [userId, setUserId] = useState(null);
          const [isAuthReady, setIsAuthReady] = useState(false);
          const [projects, setProjects] = useState([]);
          const [selectedProjectId, setSelectedProjectId] = useState('');
          const [runningProjectId, setRunningProjectId] = useState(null);
          const [elapsedTime, setElapsedTime] = useState(0);
          const [isTLView, setIsTLView] = useState(false);
          const [newProjectName, setNewProjectName] = useState('');
          const [numNewTasks, setNumNewTasks] = useState(1);
          const [currentModal, setCurrentModal] = useState(null);
          const [modalData, setModalData] = useState({});
        
          // Initialize Firebase and auth state
          useEffect(() => {
            try {
              const app = initializeApp(window.firebaseConfig);
              const firestore = getFirestore(app);
              const firebaseAuth = getAuth(app);
              setDb(firestore);
              setAuth(firebaseAuth);
        
              const unsubscribe = firebaseAuth.onAuthStateChanged(async (user) => {
                if (user) {
                  setUserId(user.uid);
                } else {
                  try {
                    const anonymousUser = await signInAnonymously(firebaseAuth);
                    setUserId(anonymousUser.user.uid);
                  } catch (error) {
                    console.error("Anonymous sign-in failed:", error);
                    setUserId(crypto.randomUUID());
                  }
                }
                setIsAuthReady(true);
              });
        
              return () => unsubscribe();
            } catch (error) {
                    console.error("Firebase initialization error:", error);
                    setIsAuthReady(false);
                    setUserId(crypto.randomUUID());
                }
            }, []);
        
            // Set up real-time listener for projects
            useEffect(() => {
                if (!db || !userId) return;
        
                const projectsQuery = query(collection(db, collectionPath), orderBy('creationTimestamp', 'desc'));
        
                const unsubscribe = onSnapshot(projectsQuery, (snapshot) => {
                    const fetchedProjects = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        // Convert Firestore Timestamps to JS Date objects
                        startTimeDay1: doc.data().startTimeDay1?.toDate(),
                        finishTimeDay1: doc.data().finishTimeDay1?.toDate(),
                        createdAt: doc.data().creationTimestamp?.toDate(),
                    }));
        
                    // Find the currently running project for this user
                    const runningProject = fetchedProjects.find(
                        p => p.assignedTo === userId && p.status === 'InProgressDay1'
                    );
                    setRunningProjectId(runningProject ? runningProject.id : null);
                    setProjects(fetchedProjects);
                }, (error) => {
                    console.error("Error fetching projects:", error);
                });
        
                return () => unsubscribe();
            }, [db, userId]);
        
          // Add default test project on first load if the collection is empty
          useEffect(() => {
            if (!db) return;
        
            const checkAndAddTestProject = async () => {
              try {
                const projectsRef = collection(db, collectionPath);
                const snapshot = await getDocs(projectsRef);
        
                if (snapshot.empty) {
                  console.log("Projects collection is empty. Adding a default test project.");
                  const batch = writeBatch(db);
                  const batchId = `test_batch_${Date.now()}`;
                  const projectName = "Test Project";
                  const numTasks = 10;
                  
                  for (let i = 1; i <= numTasks; i++) {
                    const newProjectRef = doc(projectsRef);
                    batch.set(newProjectRef, {
                      batchId,
                      baseProjectName: projectName,
                      areaTask: `Area${String(i).padStart(2, '0')}`,
                      fixCategory: "Fix1",
                      gsd: "3in",
                      assignedTo: "",
                      status: "Available",
                      durationDay1Ms: null,
                      startTimeDay1: null,
                      finishTimeDay1: null,
                      isLocked: false,
                      isReassigned: false,
                      releasedToNextStage: false,
                      creationTimestamp: serverTimestamp(),
                      lastModifiedTimestamp: serverTimestamp()
                    });
                  }
                  await batch.commit();
                  console.log("Default test project added successfully!");
                }
              } catch (error) {
                console.error("Error checking for or adding test project:", error);
              }
            };
            
            checkAndAddTestProject();
          }, [db]);
        
          // Timer logic
          useEffect(() => {
            let interval;
            if (runningProjectId) {
              const project = projects.find(p => p.id === runningProjectId);
              if (project && project.startTimeDay1) {
                interval = setInterval(() => {
                  setElapsedTime(Date.now() - project.startTimeDay1.getTime());
                }, 1000);
              }
            } else {
              setElapsedTime(0);
            }
            return () => clearInterval(interval);
          }, [runningProjectId, projects]);
        
          const handleStartTimer = async () => {
            if (!db || !userId || !selectedProjectId) {
              console.warn("Cannot start timer: Firestore, user ID, or project not ready.");
              return;
            }
        
            const projectToStart = projects.find(p => p.id === selectedProjectId);
            if (!projectToStart || projectToStart.status !== 'Available') {
              console.warn("Cannot start timer: Selected project is not available.");
              return;
            }
        
            if (runningProjectId) {
              const currentRunningTask = projects.find(p => p.id === runningProjectId);
              await handleStopTimer(currentRunningTask);
            }
        
            try {
              const docRef = doc(db, collectionPath, selectedProjectId);
              await updateDoc(docRef, {
                status: 'InProgressDay1',
                assignedTo: userId,
                startTimeDay1: serverTimestamp(),
              });
              setRunningProjectId(selectedProjectId);
            } catch (error) {
              console.error("Error starting timer:", error);
            }
          };
        
          const handleStopTimer = async (project) => {
            if (!db || !userId || !project || !project.startTimeDay1) {
              console.warn("Cannot stop timer: Project or start time is missing.");
              return;
            }
        
            try {
              const docRef = doc(db, collectionPath, project.id);
              const currentTime = new Date();
              const newDurationMs = (project.durationDay1Ms || 0) + (currentTime.getTime() - project.startTimeDay1.getTime());
        
              await updateDoc(docRef, {
                status: 'Day1Ended_AwaitingNext',
                finishTimeDay1: serverTimestamp(),
                durationDay1Ms: newDurationMs,
              });
              setRunningProjectId(null);
              setSelectedProjectId('');
            } catch (error) {
              console.error("Error stopping timer:", error);
            }
          };
        
          const handleAddProject = async (e) => {
            e.preventDefault();
            if (!db || !newProjectName.trim() || numNewTasks < 1) return;
        
            try {
              const batchId = `batch_${Date.now()}`;
              const firestoreBatch = writeBatch(db);
        
              for (let i = 1; i <= numNewTasks; i++) {
                const newProjectRef = doc(collection(db, collectionPath));
                firestoreBatch.set(newProjectRef, {
                  batchId,
                  baseProjectName: newProjectName.trim(),
                  areaTask: `Area${String(i).padStart(2, '0')}`,
                  fixCategory: "Fix1",
                  gsd: "3in",
                  assignedTo: "",
                  status: "Available",
                  durationDay1Ms: null,
                  startTimeDay1: null,
                  finishTimeDay1: null,
                  isLocked: false,
                  isReassigned: false,
                  releasedToNextStage: false,
                  creationTimestamp: serverTimestamp(),
                  lastModifiedTimestamp: serverTimestamp()
                });
              }
        
              await firestoreBatch.commit();
              setNewProjectName('');
              setNumNewTasks(1);
            } catch (error) {
              console.error("Error adding projects:", error);
            }
          };
        
          const handleDeleteProject = async (id) => {
              try {
                await deleteDoc(doc(db, collectionPath, id));
              } catch (error) {
                console.error("Error deleting project:", error);
              }
          };
        
          const handleReleaseToNextFix = async (project) => {
            if (!db || !project) return;
            const currentFixIndex = FIX_CATEGORIES.ORDER.indexOf(project.fixCategory);
            if (currentFixIndex < 0 || currentFixIndex >= FIX_CATEGORIES.ORDER.length - 1) return;
        
            const nextFixCategory = FIX_CATEGORIES.ORDER[currentFixIndex + 1];
        
            try {
              const batch = writeBatch(db);
              const docRef = doc(db, collectionPath, project.id);
              
              const newDocRef = doc(collection(db, collectionPath));
              batch.set(newDocRef, {
                ...project,
                id: undefined,
                fixCategory: nextFixCategory,
                status: "Available",
                durationDay1Ms: null,
                startTimeDay1: null,
                finishTimeDay1: null,
                isLocked: false,
                isReassigned: false,
                releasedToNextStage: false,
                creationTimestamp: serverTimestamp(),
                lastModifiedTimestamp: serverTimestamp()
              });
        
              batch.update(docRef, {
                releasedToNextStage: true
              });
        
              await batch.commit();
            } catch (error) {
              console.error("Error releasing to next fix:", error);
            }
          };
        
          const showConfirmationModal = (action, data) => {
            setCurrentModal('confirmation');
            setModalData({ action, ...data });
          };
        
          const handleModalAction = async () => {
            if (modalData.action === 'delete') {
              await handleDeleteProject(modalData.id);
            } else if (modalData.action === 'release') {
              const project = projects.find(p => p.id === modalData.id);
              await handleReleaseToNextFix(project);
            }
            setCurrentModal(null);
            setModalData({});
          };
        
          const availableProjects = projects.filter(p => p.status === 'Available' || p.status === 'Day1Ended_AwaitingNext');
          const runningProject = projects.find(p => p.assignedTo === userId && p.status === 'InProgressDay1');
        
          const totalTimePerProject = projects.reduce((acc, project) => {
              const projectName = project.baseProjectName;
              const fixCat = project.fixCategory;
              const durationMs = project.durationDay1Ms || 0;
        
              if (!acc[projectName]) {
                  acc[projectName] = {};
              }
              if (!acc[projectName][fixCat]) {
                  acc[projectName][fixCat] = 0;
              }
              acc[projectName][fixCat] += durationMs;
              return acc;
          }, {});
          
          const sortedProjects = [...projects].sort((a, b) => {
            const nameA = a.baseProjectName || "";
            const nameB = b.baseProjectName || "";
            if (nameA < nameB) return -1;
            if (nameA > nameB) return 1;
            return 0;
          });
        
          if (!isAuthReady) {
            return (
              <div className="flex items-center justify-center min-h-screen bg-slate-900 text-white font-inter">
                <div className="text-xl">Loading...</div>
              </div>
            );
          }
        
          return (
            <div className="min-h-screen bg-slate-900 text-white p-6 md:p-12 font-inter flex flex-col items-center">
              <div className="max-w-4xl w-full">
                <div className="flex justify-center mb-6 space-x-4">
                  <button
                    onClick={() => setIsTLView(false)}
                    className={`px-6 py-2 rounded-full font-bold transition-colors ${!isTLView ? 'bg-indigo-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}
                  >
                    My Tracker
                  </button>
                  <button
                    onClick={() => setIsTLView(true)}
                    className={`px-6 py-2 rounded-full font-bold transition-colors ${isTLView ? 'bg-indigo-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}
                  >
                    TL Portal
                  </button>
                </div>
        
                {isTLView ? (
                  // TL Portal View
                  <div className="space-y-8">
                    <h1 className="text-4xl font-bold text-center text-indigo-400">TL Portal</h1>
                    
                    <div className="bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg border border-slate-700">
                      <h2 className="text-xl font-semibold mb-4 text-slate-300">Add New Project</h2>
                      <form onSubmit={handleAddProject} className="flex flex-col gap-4">
                        <input
                          type="text"
                          value={newProjectName}
                          onChange={(e) => setNewProjectName(e.target.value)}
                          placeholder="Enter project name..."
                          className="bg-slate-700 text-white p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"
                          required
                        />
                        <input
                          type="number"
                          value={numNewTasks}
                          onChange={(e) => setNumNewTasks(e.target.value)}
                          min="1"
                          placeholder="Number of tasks"
                          className="bg-slate-700 text-white p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"
                          required
                        />
                        <button
                          type="submit"
                          className="bg-indigo-600 text-white p-3 rounded-xl flex items-center justify-center shadow-md hover:bg-indigo-500 transition-colors"
                        >
                          <PlusIcon className="mr-2" /> Add Project
                        </button>
                      </form>
                    </div>
        
                    <div className="bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg border border-slate-700">
                        <h2 className="text-xl font-semibold mb-4 text-slate-300">Project Summary</h2>
                        {Object.keys(totalTimePerProject).length === 0 ? (
                            <p className="text-center text-slate-500 italic">No projects with recorded time found.</p>
                        ) : (
                            <ul className="space-y-4">
                                {Object.keys(totalTimePerProject).map(projectName => (
                                    <li key={projectName} className="bg-slate-700 p-4 rounded-xl shadow-md">
                                        <h3 className="text-lg font-bold text-indigo-300 mb-2">{projectName}</h3>
                                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 text-sm text-slate-400">
                                            {Object.keys(totalTimePerProject[projectName]).map(fixCat => (
                                                <div key={fixCat} className="bg-slate-600 p-2 rounded-md">
                                                    <span className="font-semibold text-slate-300">{fixCat}:</span>
                                                    <p className="font-mono">{formatTotalMinutes(totalTimePerProject[projectName][fixCat])}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        )}
                    </div>
        
                    <div className="bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg border border-slate-700">
                      <h2 className="text-xl font-semibold mb-4 text-slate-300">Manage All Projects</h2>
                      <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-slate-700">
                          <thead className="bg-slate-700">
                            <tr>
                              <th className="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Project</th>
                              <th className="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Task</th>
                              <th className="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Fix</th>
                              <th className="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Status</th>
                              <th className="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Time</th>
                              <th className="px-6 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider">Actions</th>
                            </tr>
                          </thead>
                          <tbody className="bg-slate-800 divide-y divide-slate-700">
                            {sortedProjects.length === 0 ? (
                              <tr>
                                <td colSpan="6" className="text-center text-slate-500 italic py-4">No projects found.</td>
                              </tr>
                            ) : (
                              sortedProjects.map((project) => (
                                <tr key={project.id} className="hover:bg-slate-700 transition-colors">
                                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-indigo-300">{project.baseProjectName}</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-400">{project.areaTask}</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-400">{project.fixCategory}</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm">
                                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                      project.status === 'Available' ? 'bg-green-100 text-green-800' :
                                      project.status === 'InProgressDay1' ? 'bg-yellow-100 text-yellow-800' :
                                      'bg-slate-100 text-slate-800'
                                    }`}>
                                      {project.status}
                                    </span>
                                  </td>
                                  <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-400">{formatTotalMinutes(project.durationDay1Ms)}</td>
                                  <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                    <button
                                      onClick={() => showConfirmationModal('delete', { id: project.id, name: project.baseProjectName })}
                                      className="text-red-400 hover:text-red-600"
                                      aria-label="Delete Project"
                                    >
                                      <Trash2Icon className="w-5 h-5" />
                                    </button>
                                    {project.status === 'Day1Ended_AwaitingNext' && (
                                        <button
                                          onClick={() => showConfirmationModal('release', { id: project.id, name: project.baseProjectName })}
                                          className="text-green-400 hover:text-green-600"
                                          aria-label="Release to Next Fix"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M21 5H9a7 7 0 0 0 0 14h2"></path></svg>
                                        </button>
                                    )}
                                  </td>
                                </tr>
                              ))
                            )}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                ) : (
                  // User Tracker View
                  <div className="space-y-8">
                    <h1 className="text-4xl font-bold mb-8 text-center text-indigo-400">Project Time Tracker</h1>
                    {runningProject ? (
                      <div className="bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg border border-slate-700 mb-8 flex flex-col items-center text-center">
                        <h2 className="text-xl font-semibold text-slate-300">Currently Tracking</h2>
                        <p className="text-3xl md:text-4xl font-extrabold text-white my-4">{runningProject.baseProjectName}</p>
                        <p className="text-sm md:text-base text-slate-400 mb-2">
                          Area/Task: {runningProject.areaTask}
                        </p>
                        <div className="text-5xl md:text-6xl font-mono text-green-400 my-4">
                          {formatDuration(elapsedTime)}
                        </div>
                        <p className="text-sm md:text-base text-slate-400 mb-4">
                          Total Recorded: {formatTotalMinutes(runningProject.durationDay1Ms)}
                        </p>
                        <button
                          onClick={() => handleStopTimer(runningProject)}
                          className="bg-red-600 text-white p-4 rounded-full flex items-center justify-center shadow-md hover:bg-red-500 transition-colors"
                        >
                          <StopIcon className="w-8 h-8" />
                        </button>
                      </div>
                    ) : (
                      <div className="bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg border border-slate-700 mb-8">
                        <h2 className="text-xl font-semibold mb-4 text-slate-300">Start a New Timer</h2>
                        <div className="flex flex-col sm:flex-row gap-4">
                          <div className="flex-grow">
                            <label htmlFor="project-select" className="block text-sm font-medium text-slate-400 mb-2">Select an Available Project</label>
                            <select
                              id="project-select"
                              value={selectedProjectId}
                              onChange={(e) => setSelectedProjectId(e.target.value)}
                              className="w-full bg-slate-700 text-white p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors"
                            >
                              <option value="" disabled>Select a project...</option>
                              {availableProjects.map((project) => (
                                <option key={project.id} value={project.id}>
                                  {project.baseProjectName} - {project.areaTask}
                                </option>
                              ))}
                            </select>
                          </div>
                          <button
                            onClick={handleStartTimer}
                            disabled={!selectedProjectId}
                            className={`bg-indigo-600 text-white p-3 rounded-xl flex items-center justify-center shadow-md transition-colors self-end ${!selectedProjectId ? 'opacity-50 cursor-not-allowed' : 'hover:bg-indigo-500'}`}
                          >
                            <PlayIcon />
                          </button>
                        </div>
                        {availableProjects.length === 0 && (
                          <p className="text-center text-slate-500 italic py-8">
                            No available projects found.
                          </p>
                        )}
                      </div>
                    )}
                  </div>
                )}
        
              </div>
              {currentModal === 'confirmation' && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
                  <div className="bg-slate-800 p-8 rounded-xl shadow-lg border border-slate-700 max-w-sm w-full text-center">
                    <p className="text-lg font-bold text-red-400 mb-4">
                      Confirm Action
                    </p>
                    <p className="text-slate-300 mb-6">
                      {modalData.action === 'delete' && `Are you sure you want to delete the project '${modalData.name}'? This cannot be undone.`}
                      {modalData.action === 'release' && `Are you sure you want to release task '${modalData.name}' to the next stage? This cannot be undone.`}
                    </p>
                    <div className="flex justify-center space-x-4">
                      <button
                        onClick={handleModalAction}
                        className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-500"
                      >
                        Confirm
                      </button>
                      <button
                        onClick={() => setCurrentModal(null)}
                        className="px-4 py-2 bg-slate-600 text-white rounded-md hover:bg-slate-500"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);

    </script>
</body>
</html>

